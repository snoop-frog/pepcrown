<!DOCTYPE html>
<html lang="en"><script src="chrome-extension://dlcobpjiigpikoobohmabehhmhfoodbb/inpage.js" id="argent-x-extension" data-extension-id="dlcobpjiigpikoobohmabehhmhfoodbb"></script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Interactive Image Overlay</title>
<style>
  body, html { height: 100%; margin: 0; font-family: Arial, sans-serif; background-color: black; color: white; }
  .container { position: relative; width: 50%; margin: 20px auto; }
  .image-display { position: relative; overflow: hidden; }
  img { width: 100%; height: auto; display: block; }
  #overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: transform 0.1s ease; }
  button, input[type="range"], input[type="file"] { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; display: block; width: 100%; }
  label { display: block; text-align: center; font-size: 16px; margin-top: 10px; }
</style>
<script src="chrome-extension://idnnbdplmphpflfnlkomgpfbpcgelopg/inpage.js" id="xverse-wallet-provider" data-is-priority=""></script></head>
<body>
<script src="chrome-extension://ldinpeekobnhjjdofggfgjlcehhmanlj/inpage.js" id="leather-provider"></script><div class="container">
  <div class="image-display" id="imageContainer"></div>
  <input type="file" id="upload" accept="image/*" onchange="previewFile()">
  <label for="scale-slider">Resize Crown:</label>
  <input type="range" id="scale-slider" min="0.05" max="3" step="0.01" value="1" onchange="updateTransform()">
  <label for="rotate-slider">Rotate Crown:</label>
  <input type="range" id="rotate-slider" min="-180" max="180" step="1" value="0" onchange="updateTransform()">
  <button id="saveBtn" onclick="saveImage()">Save Pepodin</button>
</div>

<script>
  let scale = 1, angle = 0;

function previewFile() {
    const file = document.querySelector('input[type=file]').files[0];
    const reader = new FileReader();
    reader.addEventListener("load", function () {
        const uploadedImage = new Image();
        uploadedImage.src = reader.result;
        uploadedImage.onload = function () {
            const imageContainer = document.getElementById('imageContainer');
            imageContainer.style.position = 'relative';
            imageContainer.innerHTML = `<img src="${reader.result}" alt="Uploaded Image" style="width: 512px; height: 512px;"/>`; // Set preview image size to 512x512
            const overlay = document.createElement('img');
            overlay.id = 'overlay';
            overlay.crossOrigin = "anonymous";
            overlay.src = 'https://i.imgur.com/a5srfjG.png';
            overlay.style.width = '512px'; // Set overlay size to 512x512
            overlay.style.height = '512px';
            overlay.onload = function () {
                imageContainer.appendChild(overlay);
                initDrag(overlay);
            };
        };
    }, false);

    if (file) {
        reader.readAsDataURL(file);
    }
}

function initDrag(elmnt) {
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  elmnt.onmousedown = elmnt.ontouchstart = dragMouseDown;

  function dragMouseDown(e) {
    e.preventDefault();
    if (e.type === "touchstart") {
      pos3 = e.touches[0].clientX;
      pos4 = e.touches[0].clientY;
    } else {
      pos3 = e.clientX;
      pos4 = e.clientY;
    }
    document.onmouseup = document.ontouchend = closeDragElement;
    document.onmousemove = document.ontouchmove = elementDrag;
  }

  function elementDrag(e) {
    if (e.type === "touchmove") {
      pos1 = pos3 - e.touches[0].clientX;
      pos2 = pos4 - e.touches[0].clientY;
      pos3 = e.touches[0].clientX;
      pos4 = e.touches[0].clientY;
    } else {
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
    }
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    document.onmouseup = document.ontouchend = null;
    document.onmousemove = document.ontouchmove = null;
  }
}

function updateTransform() {
  const scaleSlider = document.getElementById('scale-slider');
  const rotateSlider = document.getElementById('rotate-slider');
  scale = scaleSlider.value;
  angle = rotateSlider.value;
  const overlay = document.getElementById('overlay');
  overlay.style.transform = `translate(-50%, -50%) scale(${scale}) rotate(${angle}deg)`;
}

function saveImage() {
  const imageContainer = document.getElementById('imageContainer');
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  const img = imageContainer.querySelector('img');
  const overlay = document.getElementById('overlay');

  canvas.width = canvas.height = 512; // Force the canvas to be 512x512
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

  const transform = window.getComputedStyle(overlay).transform;
  const matrix = transform.match(/^matrix\((.+)\)$/);
  const scaleFactors = matrix ? matrix[1].split(', ').map(Number) : [1, 0, 0, 1, 0, 0];
  const scaleX = scaleFactors[0];
  const scaleY = scaleFactors[3];
  const offsetX = parseFloat(window.getComputedStyle(overlay).left);
  const offsetY = parseFloat(window.getComputedStyle(overlay).top);

  ctx.translate(offsetX, offsetY);
  ctx.scale(scaleX, scaleY);
  ctx.drawImage(overlay, -overlay.width / 2, -overlay.height / 2);

  ctx.setTransform(1, 0, 0, 1, 0, 0);
  const dataURL = canvas.toDataURL('image/png');
  downloadImage(dataURL, 'composite-image.png');
}

function downloadImage(dataURL, filename) {
    const link = document.createElement('a');
    link.download = filename;
    link.href = dataURL;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

</script>


</body></html>